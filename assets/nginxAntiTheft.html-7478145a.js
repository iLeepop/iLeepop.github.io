import{_ as n,o as s,c as a,a as e}from"./app-5539d687.js";const t={},p=e(`<h1 id="防盗链" tabindex="-1"><a class="header-anchor" href="#防盗链" aria-hidden="true">#</a> 防盗链</h1><p>就是防小偷，防其它网站偷你网站的内容。</p><p><strong>当然不一定防得住。</strong></p><p>在一般的大型网站中，打开控制台的 <strong>Network</strong>，查看图片或者其它资源，可以在 <strong>Request Headers</strong> 里找到 <strong>referer</strong> 属性。</p><p>详情见下图：</p><p>......</p><p>可惜没图，以后再弄吧，反正你能看见有个 <strong>referer</strong> 属性。</p><p>它所指明的就是发起请求的域名。</p><p>通过它，我们就能够判断，是否是其它网站在挪用咱们网站的资源。</p><h2 id="防住" tabindex="-1"><a class="header-anchor" href="#防住" aria-hidden="true">#</a> 防住</h2><p>打开命令行：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /etc/nginx/
<span class="token comment">#找到自己的Nginx安装位置</span>
<span class="token builtin class-name">cd</span> ./conf.d
<span class="token comment">#</span>
<span class="token function">ls</span>
<span class="token comment">#</span>
<span class="token function">vim</span> ilee.conf
<span class="token comment">#创建并编辑一个你自己的.conf配置文件	</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这是咱之前的：</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">81</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /home/page/</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改后：</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">81</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /home/page/</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">location</span> ~* \\.(gif|jpg|png)$</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /home/page/img/</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">valid_referers</span> none blocked baidu.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">rewrite</span> ^ http://你的IP:81/error.jpeg</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">break</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到里面有一个 <strong>valid_referers</strong> 后面接的是 none blocked 意思是不去阻止，后面写的是 baidu.com ，这个可以去主机host里面改，Windows10系统的 host 在 C:\\Windows\\System32\\drivers\\etc\\ 目录下：</p><div class="language-host line-numbers-mode" data-ext="host"><pre class="language-host"><code>YourrIP baidu.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这样在浏览器中输入 baidu.com:81 即可访问到正确的资源，但是以 ip 去访问则无法获取到资源。</p><p>确保图片资源都上传到位，接着重新加载配置：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nginx <span class="token parameter variable">-s</span> reload
<span class="token comment">#也可以使用这个</span>
<span class="token operator">!</span>nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编辑访问的 index.html 文件：</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>
            Hi,CRfilee
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://你的ip:81/123.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>去试一下访问：</p><ol><li>baidu.com:81</li><li>你的ip:81</li></ol><p>看看得到的结果是否相同。</p><h2 id="防不住" tabindex="-1"><a class="header-anchor" href="#防不住" aria-hidden="true">#</a> 防不住</h2><p><strong>防得住吗？真的防的住吗？防不住吧？</strong></p><p>上述的案例很简单，同时有着很明显的缺点就是，如果服务器无法获取 referer 的值，就无法进行判断。</p><p>将 index.html 修改一下：</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>referrer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>no-referrer<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>
            Hi,CRfilee
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://你的ip:81/123.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再使用ip访问，发现可以获取到正确的结果。</p><p>可以自己反复修改，来看看是怎么个事。</p><p>当然，这里的案例都很简单，没有实际意义，但是有盾就有矛，有好就有坏，遇到问题有能力处理才是最关键的。</p>`,34),i=[p];function l(c,o){return s(),a("div",null,i)}const d=n(t,[["render",l],["__file","nginxAntiTheft.html.vue"]]);export{d as default};
