import{_ as e,o as n,c as a,a as i}from"./app-5539d687.js";const s={},d=i(`<h1 id="限流" tabindex="-1"><a class="header-anchor" href="#限流" aria-hidden="true">#</a> 限流</h1><h2 id="令牌桶算法" tabindex="-1"><a class="header-anchor" href="#令牌桶算法" aria-hidden="true">#</a> 令牌桶算法</h2><p>nothing😆</p><h2 id="漏桶算法" tabindex="-1"><a class="header-anchor" href="#漏桶算法" aria-hidden="true">#</a> 漏桶算法</h2><p>nothing😆</p><h2 id="请求限流" tabindex="-1"><a class="header-anchor" href="#请求限流" aria-hidden="true">#</a> 请求限流</h2><p><strong>语法</strong>：</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">usage:</span> limit_req zone=name [burst=number] [nodelay | delay=number]</span><span class="token punctuation">;</span>
default: -
上下文: http, server, location
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>样例</strong>：</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone=ip_limit:10m rate=1r/s</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>参数一：<code>$binary_remote_addr</code>表示通过remote_addr这个标识来做限制，限制的是同一客户端IP地址，在这里，客户端IP地址作为关键，不是<code>$ remote_addr</code>，而是<code>$binary_remote_addr</code>变量。<code>$ remote_addr</code>变量的大小可以从7字节到15字节不等。存储的状态在32位平台上占用32或64字节的内存，在64位平台上总是占用64字节，对于IPv4地址，<code>$binary_remote_addr</code>变量的大小始终为4字节，对于IPv6地址则为16个字节。存储状态在32位平台上始终占用32或64字节，在64位平台占用64字节。一个兆字节的区域可以保持大约32000个32字节的状态或大约16000个64字节的状态。如果区域存储耗尽，服务器会将错误返回给所有其它请求。</li><li>参数二：<code>zone=ip_limit:10m</code>表示生成一个10M大小的名字为<code>ip_limit</code>的内存区域，主要用来存储访问的频次信息。</li><li>参数三：<code>rate=1r/s</code>表示允许相同标识的客户端的一个访问频次，1r的意思是1次。</li></ul><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">limit_req</span> zone=ip_limit burst=5 nodelay</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>参数一：<code>zone</code>表示使用那个区域来做限制，这里与上面一样。</li><li>参数二：<code>burst</code>爆发的意思，意思是设置一个大小为5的缓冲区，当有大量请求爆发的时候，超过了访问频次限制的请求可以先放到这个缓冲区内。</li><li>参数三：<code>nodelay</code>超过访问频次而且缓冲区也满了的时候就会直接返回503，如果没有设置，则所有请求会等待排队。</li></ul><h2 id="连接限流" tabindex="-1"><a class="header-anchor" href="#连接限流" aria-hidden="true">#</a> 连接限流</h2><p><strong>语法</strong>：</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">usage:</span> limit_conn zone number</span><span class="token punctuation">;</span>
default: -
上下文: http, server, location
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>样例</strong>：</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$binary_remote_addr</span> zone=addr:10m</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>参数一：<code>$binary_remote_addr</code>表示通过 <code>remote_addr</code>这个标识符来做限制，限制的是同一客户端IP地址。</li><li>参数二：<code>zone=ip_limit:10m</code>表示生成一个10M大小的名字为<code>ip_limit</code>的内存区域，主要用来存储访问的频次信息。</li></ul><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">limit_conn</span> addr <span class="token number">1</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>参数一：<code>zone</code>表示使用那个区域来做限制，跟上面一样。</li><li>参数二：表示允许相同标识客户端的一个访问频次，这里的1代表的是只允许每个IP地址一个连接。</li></ul>`,21),r=[d];function l(o,c){return n(),a("div",null,r)}const p=e(s,[["render",l],["__file","nginxRateLimit.html.vue"]]);export{p as default};
